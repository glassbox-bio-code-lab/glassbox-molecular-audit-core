apiVersion: app.k8s.io/v1beta1
kind: Application
metadata:
  name: ${NAME}
  namespace: ${NAMESPACE}
  labels:
    app.kubernetes.io/name: molecular-audit-core
    app.kubernetes.io/instance: ${NAME}
    app.kubernetes.io/part-of: glassbox-marketplace
  annotations:
    # Replace partner_id/product_id with your Producer Portal identifiers before submission.
    marketplace.cloud.google.com/deploy-info: '{"partner_id":"REPLACE_PARTNER_ID","product_id":"REPLACE_PRODUCT_ID","partner_name":"Glassbox Bio"}'
spec:
  descriptor:
    type: molecular-audit-core
    version: "1.0.0"
    description: Deterministic computational validation dossier for target tractability (Glassbox Bio Molecular Audit).
    maintainers:
      - name: Glassbox Bio
    keywords:
      - computational validation
      - ligandability
      - docking
      - reproducibility
      - kubernetes

  selector:
    matchLabels:
      app.kubernetes.io/instance: ${NAME}

  addOwnerRef: true

  componentKinds:
    - group: ""
      kind: ConfigMap
    - group: ""
      kind: PersistentVolumeClaim
    - group: ""
      kind: Secret
    - group: ""
      kind: Service
    - group: apps
      kind: Deployment
    - group: batch
      kind: Job
    - group: rbac.authorization.k8s.io
      kind: Role
    - group: rbac.authorization.k8s.io
      kind: RoleBinding

  info:
    - name: Console (HTTP)
      type: Reference
      valueFrom:
        type: ServiceRef
        serviceRef:
          name: ${NAME}-console
          port: 80
          path: /

  notes: |-
    ## Access the Console

    Port-forward the in-cluster console service:

    ```bash
    kubectl -n ${NAMESPACE} port-forward svc/${NAME}-console 8080:80
    ```

    Then open `http://localhost:8080`.

    ## Run an Audit

    Use the Console UI to validate inputs and start an audit run (this triggers metering for Marketplace listings).

    For the full runbook, see `docs/RUNBOOK_CUSTOMER.md` in the public repo.
